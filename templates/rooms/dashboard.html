{% extends 'base.html' %}

{% block title %}Dashboard - Hotel Snow PMS{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2>üè® Hotel Snow Dashboard</h2>
        <p class="text-muted">Welcome, {{ user.get_full_name|default:user.username }}! Today is {{ today|date:'F d, Y' }}</p>
    </div>
</div>

<!-- Popup Memos -->
{% if popup_memos %}
{% for memo in popup_memos %}
<div class="alert alert-info alert-dismissible fade show" role="alert">
    <strong>{{ memo.title }}</strong><br>
    {{ memo.content|linebreaks }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
{% endfor %}
{% endif %}

<div class="row mb-4">
    <!-- Quick Stats -->
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <h5>Today's Arrivals</h5>
                <h2>{{ bookings|length }}</h2>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <h5>Total Rooms</h5>
                <h2>{{ rooms|length }}</h2>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <h5>Active Bookings</h5>
                <h2>{{ bookings|length }}</h2>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <h5>Week Range</h5>
                <p class="mb-0">{{ start_date|date:'M d' }} - {{ end_date|date:'M d' }}</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Quick Actions -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'create_booking' %}" class="btn btn-primary">
                        üìù New Booking
                    </a>
                    <a href="{% url 'timeline' %}" class="btn btn-info">
                        üìÖ View Timeline
                    </a>
                    {% if user.user_type == 'SUPER' %}
                    <a href="{% url 'manage_rates' %}" class="btn btn-warning">
                        üí∞ Manage Rates
                    </a>
                    <a href="{% url 'system_memo' %}" class="btn btn-secondary">
                        üìã System Memos
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recent Bookings -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>Recent Bookings This Week</h5>
            </div>
            <div class="card-body">
                {% if bookings %}
                <div class="list-group list-group-flush">
                    {% for booking in bookings|slice:":5" %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ booking.guest_name }}</strong><br>
                            <small>{{ booking.room.room_number }} - {{ booking.check_in_date|date:'M j' }} to {{ booking.check_out_date|date:'M j' }}</small>
                        </div>
                        <span class="badge" style="background-color: 
                            {% if booking.get_display_color == 'green' %}#28a745
                            {% elif booking.get_display_color == 'yellow' %}#ffc107; color: black
                            {% elif booking.get_display_color == 'red' %}#dc3545
                            {% elif booking.get_display_color == 'violet' %}#6f42c1
                            {% else %}#6c757d{% endif %};">
                            {{ booking.get_payment_status_display }}
                        </span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No bookings for this week.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <!-- Room Types Overview -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5>Room Types & Rates</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% regroup rooms by room_type as room_groups %}
                    {% for group in room_groups %}
                    <div class="col-md-4 mb-3">
                        <div class="card border-secondary">
                            <div class="card-header bg-secondary text-white">
                                <h6 class="mb-0">{{ group.grouper.get_name_display }}</h6>
                            </div>
                            <div class="card-body">
                                <p class="mb-1"><small>Weekday: ‚Ç±{{ group.grouper.base_weekday_rate }}</small></p>
                                <p class="mb-2"><small>Weekend: ‚Ç±{{ group.grouper.base_weekend_rate }}</small></p>
                                <div class="room-numbers">
                                    {% for room in group.list %}
                                    <span class="badge bg-light text-dark me-1">{{ room.room_number }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}